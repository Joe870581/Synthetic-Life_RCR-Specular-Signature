
// hal_range_sensor.c (Reference ToF Driver Wrapper)
#include "hal_range_sensor.h"
#include "hal_i2c.h"

#define TOF_SENSOR_I2C_ADDR 0x29
#define TOF_MAX_RANGE_M     4.0f

static bool sensor_ready = false;

bool hal_range_sensor_init(void) {
    if (!hal_i2c_init() || !hal_i2c_probe(TOF_SENSOR_I2C_ADDR)) return false;
    sensor_ready = true;
    return true;
}

bool hal_range_sensor_read_m(float* distance_m) {
    if (!sensor_ready) return false;
    uint16_t raw_mm;
    
    if (/* I2C read error */) return false;
    if (raw_mm == 0xFFFF || raw_mm == 0x0000) return false;

    *distance_m = (float)raw_mm / 1000.0f;

    if (*distance_m > TOF_MAX_RANGE_M || *distance_m <= 0.0f) return false;

    return true;
}
